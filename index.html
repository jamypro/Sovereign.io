<!DOCTYPE html>
<html>
<head>
    <title>Sovereign.io - Working Prototype</title>
    <style>
        body { 
            margin: 0; 
            padding: 20px;
            background: #1a1a1a; 
            color: white; 
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .game-area {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        canvas {
            border: 2px solid #3498db;
            background: #2c3e50;
        }
        .ui-panel {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            min-width: 250px;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }
        button:hover {
            background: #2980b9;
        }
        button:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
        }
        .resource {
            margin: 10px 0;
            padding: 8px;
            background: #34495e;
            border-radius: 4px;
        }
        .territory {
            width: 6px;
            height: 6px;
            display: inline-block;
            margin: 1px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè∞ Sovereign.io - WORKING PROTOTYPE</h1>
        <p>Click on the map to send armies! Claim territories and generate resources.</p>
        
        <div class="game-area">
            <div>
                <canvas id="gameCanvas" width="600" height="600"></canvas>
            </div>
            
            <div class="ui-panel">
                <h3>Player Resources</h3>
                <div class="resource">üí∞ Gold: <span id="gold">150</span></div>
                <div class="resource">üë• Manpower: <span id="manpower">100</span></div>
                <div class="resource">üè† Territories: <span id="territories">1</span></div>
                
                <h3>Army Actions</h3>
                <button onclick="trainUnit('infantry')">
                    Train Infantry (50 gold)
                </button>
                <button onclick="trainUnit('cavalry')" id="cavalryBtn">
                    Train Cavalry (80 gold) üîí
                </button>
                <button onclick="researchTech('cavalry')" id="researchBtn">
                    Research Cavalry (100 gold)
                </button>
                
                <h3>Game Info</h3>
                <div id="gameLog"></div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            player: {
                gold: 150,
                manpower: 100,
                territories: new Set(),
                armies: [],
                research: new Set()
            },
            map: [],
            selectedArmy: null
        };

        // Canvas setup
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const TILE_SIZE = 10;
        const MAP_SIZE = 60;

        // Initialize game
        function initGame() {
            createMap();
            // Give player starting territory
            claimTerritory(5, 5, 'player');
            gameState.player.territories.add('5-5');
            render();
            updateUI();
        }

        function createMap() {
            for (let x = 0; x < MAP_SIZE; x++) {
                for (let y = 0; y < MAP_SIZE; y++) {
                    gameState.map.push({
                        x, y,
                        owner: null,
                        army: 0
                    });
                }
            }
        }

        function claimTerritory(x, y, owner) {
            const territory = gameState.map.find(t => t.x === x && t.y === y);
            if (territory) {
                if (territory.owner !== 'player') {
                    if (territory.owner === null) {
                        gameState.player.territories.add(`${x}-${y}`);
                    }
                    territory.owner = owner;
                    territory.army = owner === 'player' ? 10 : 0;
                }
            }
        }

        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw territories
            gameState.map.forEach(territory => {
                if (territory.owner === 'player') {
                    ctx.fillStyle = '#2ecc71'; // Player green
                } else if (territory.owner !== null) {
                    ctx.fillStyle = '#e74c3c'; // Enemy red
                } else {
                    ctx.fillStyle = '#34495e'; // Neutral dark
                }
                
                ctx.fillRect(
                    territory.x * TILE_SIZE,
                    territory.y * TILE_SIZE,
                    TILE_SIZE - 1,
                    TILE_SIZE - 1
                );
            });

            // Draw armies
            gameState.player.armies.forEach(army => {
                ctx.fillStyle = '#f1c40f'; // Gold color for armies
                ctx.beginPath();
                ctx.arc(
                    army.x * TILE_SIZE + TILE_SIZE/2,
                    army.y * TILE_SIZE + TILE_SIZE/2,
                    TILE_SIZE/2,
                    0,
                    Math.PI * 2
                );
                ctx.fill();
            });
        }

        // Game Mechanics
        function trainUnit(type) {
            const costs = {
                infantry: { gold: 50, manpower: 20 },
                cavalry: { gold: 80, manpower: 30 }
            };

            const cost = costs[type];
            if (gameState.player.gold >= cost.gold && gameState.player.manpower >= cost.manpower) {
                gameState.player.gold -= cost.gold;
                gameState.player.manpower -= cost.manpower;
                
                // Add army at first territory
                const startTerritory = Array.from(gameState.player.territories)[0].split('-');
                gameState.player.armies.push({
                    id: Date.now(),
                    type: type,
                    x: parseInt(startTerritory[0]),
                    y: parseInt(startTerritory[1]),
                    strength: type === 'cavalry' ? 15 : 10
                });

                addGameLog(`Trained ${type} unit!`);
                updateUI();
                render();
            } else {
                addGameLog('Not enough resources!');
            }
        }

        function researchTech(tech) {
            if (gameState.player.gold >= 100 && !gameState.player.research.has(tech)) {
                gameState.player.gold -= 100;
                gameState.player.research.add(tech);
                
                if (tech === 'cavalry') {
                    document.getElementById('cavalryBtn').innerHTML = 'Train Cavalry (80 gold) ‚úÖ';
                    document.getElementById('researchBtn').disabled = true;
                }
                
                addGameLog(`Researched ${tech}!`);
                updateUI();
            }
        }

        // Click to move armies
        canvas.addEventListener('click', (event) => {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((event.clientX - rect.left) / TILE_SIZE);
            const y = Math.floor((event.clientY - rect.top) / TILE_SIZE);

            if (gameState.player.armies.length > 0) {
                // Move first army to clicked position
                const army = gameState.player.armies[0];
                army.x = x;
                army.y = y;
                
                // Claim territory if neutral
                const territory = gameState.map.find(t => t.x === x && t.y === y);
                if (territory && territory.owner !== 'player') {
                    claimTerritory(x, y, 'player');
                    gameState.player.gold += 5; // Income from new territory
                    addGameLog('Captured new territory! +5 gold');
                }
                
                render();
                updateUI();
            }
        });

        // Economy tick - generate resources
        setInterval(() => {
            const income = gameState.player.territories.size * 2;
            gameState.player.gold += income;
            gameState.player.manpower += 1;
            
            updateUI();
        }, 3000); // Every 3 seconds

        function updateUI() {
            document.getElementById('gold').textContent = gameState.player.gold;
            document.getElementById('manpower').textContent = gameState.player.manpower;
            document.getElementById('territories').textContent = gameState.player.territories.size;
        }

        function addGameLog(message) {
            const log = document.getElementById('gameLog');
            const entry = document.createElement('div');
            entry.textContent = `> ${message}`;
            entry.style.fontSize = '12px';
            entry.style.margin = '2px 0';
            log.prepend(entry);
            
            // Keep only last 5 messages
            while (log.children.length > 5) {
                log.removeChild(log.lastChild);
            }
        }

        // Start the game!
        initGame();
        addGameLog('Game started! Click on map to move armies.');
    </script>
</body>
</html>
