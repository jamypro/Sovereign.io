<!DOCTYPE html>
<html>
<head>
    <title>Sovereign.io - Army Conquest</title>
    <style>
        body { 
            margin: 0; 
            padding: 20px; 
            background: #0a0a0a; 
            color: white; 
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .game-area {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            justify-content: center;
        }
        canvas {
            border: 2px solid #3498db;
            background: #111;
            image-rendering: pixelated;
            cursor: crosshair;
        }
        .ui-panel {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 8px;
            min-width: 200px;
            text-align: left;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }
        button:hover {
            background: #2980b9;
        }
        .resource {
            margin: 8px 0;
            padding: 6px;
            background: #2c3e50;
            border-radius: 4px;
            font-size: 14px;
        }
        .selected {
            background: #e74c3c !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè∞ Sovereign.io - Army Conquest</h1>
        <p>Click armies to select, then click map to attack! Bigger armies conquer more land.</p>
        
        <div class="game-area">
            <div>
                <canvas id="gameCanvas" width="400" height="400"></canvas>
            </div>
            
            <div class="ui-panel">
                <h3>Player Resources</h3>
                <div class="resource">üí∞ Gold: <span id="gold">200</span></div>
                <div class="resource">üë• Manpower: <span id="manpower">100</span></div>
                <div class="resource">üè† Territories: <span id="territories">1</span></div>
                
                <h3>Army Actions</h3>
                <button onclick="trainArmy()" id="trainBtn">
                    Train New Army (50 gold)
                </button>
                <button onclick="upgradeArmy()" id="upgradeBtn">
                    Upgrade Selected (30 gold)
                </button>
                <button onclick="mergeArmies()" id="mergeBtn">
                    Merge Armies (20 gold)
                </button>
                
                <h3>Selected Army</h3>
                <div id="armyInfo">None selected</div>
                
                <h3>Game Log</h3>
                <div id="gameLog" style="font-size: 12px; max-height: 150px; overflow-y: auto;"></div>
            </div>
        </div>
        
        <div style="margin-top: 20px; font-size: 12px; color: #777;">
            <p><strong>How to play:</strong> Click armies to select ‚Üí Click map to attack ‚Üí Bigger armies conquer wider paths</p>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            player: {
                id: 'player',
                color: '#3498db',
                gold: 200,
                manpower: 100,
                territories: new Set(),
                armies: []
            },
            bots: [
                { id: 'bot1', color: '#e74c3c', territories: new Set(), armies: [] },
                { id: 'bot2', color: '#f39c12', territories: new Set(), armies: [] }
            ],
            map: [],
            selectedArmy: null,
            attackTarget: null
        };

        // Canvas setup
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const PIXEL_SIZE = 1;
        const MAP_SIZE = 400;

        // Initialize game
        function initGame() {
            createMap();
            
            // Give player starting territory
            claimTerritory(200, 200, 'player', 10);
            gameState.player.territories.add('200-200');
            
            // Give bots starting territories
            claimTerritory(50, 50, 'bot1', 8);
            gameState.bots[0].territories.add('50-50');
            claimTerritory(350, 350, 'bot2', 8);  
            gameState.bots[1].territories.add('350-350');
            
            // Create starting armies
            createArmy(200, 200, 'player', 15);
            createArmy(50, 50, 'bot1', 12);
            createArmy(350, 350, 'bot2', 12);
            
            render();
            updateUI();
            addGameLog('Game started! Click armies to select them.');
        }

        function createMap() {
            for (let x = 0; x < MAP_SIZE; x++) {
                for (let y = 0; y < MAP_SIZE; y++) {
                    gameState.map.push({ x, y, owner: null });
                }
            }
        }

        function createArmy(x, y, owner, strength = 10) {
            const ownerObj = owner === 'player' ? gameState.player : gameState.bots.find(b => b.id === owner);
            const army = {
                x, y,
                target: null,
                strength: strength,
                size: Math.max(3, strength / 3), // Size based on strength
                id: Math.random().toString(36).substr(2, 9)
            };
            ownerObj.armies.push(army);
            return army;
        }

        function claimTerritory(x, y, owner, radius = 1) {
            // Claim territory in a radius around the point (bigger army = bigger radius)
            for (let dx = -radius; dx <= radius; dx++) {
                for (let dy = -radius; dy <= radius; dy++) {
                    const newX = x + dx;
                    const newY = y + dy;
                    
                    if (newX >= 0 && newX < MAP_SIZE && newY >= 0 && newY < MAP_SIZE) {
                        const territory = gameState.map.find(t => t.x === newX && t.y === newY);
                        if (territory && territory.owner !== owner) {
                            // Remove from previous owner
                            if (territory.owner === 'player') {
                                gameState.player.territories.delete(`${newX}-${newY}`);
                            } else if (territory.owner) {
                                const prevBot = gameState.bots.find(b => b.id === territory.owner);
                                if (prevBot) prevBot.territories.delete(`${newX}-${newY}`);
                            }
                            
                            // Add to new owner
                            territory.owner = owner;
                            if (owner === 'player') {
                                gameState.player.territories.add(`${newX}-${newY}`);
                            } else {
                                const bot = gameState.bots.find(b => b.id === owner);
                                if (bot) bot.territories.add(`${newX}-${newY}`);
                            }
                        }
                    }
                }
            }
        }

        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw territories
            gameState.map.forEach(territory => {
                if (territory.owner === 'player') {
                    ctx.fillStyle = gameState.player.color;
                } else if (territory.owner === 'bot1') {
                    ctx.fillStyle = gameState.bots[0].color;
                } else if (territory.owner === 'bot2') {
                    ctx.fillStyle = gameState.bots[1].color;
                } else {
                    return;
                }
                
                ctx.fillRect(territory.x, territory.y, PIXEL_SIZE, PIXEL_SIZE);
            });

            // Draw armies as circles
            [gameState.player, ...gameState.bots].forEach(owner => {
                owner.armies.forEach(army => {
                    // Draw army circle
                    ctx.fillStyle = owner.color;
                    ctx.beginPath();
                    ctx.arc(army.x, army.y, army.size, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Draw selection ring if selected
                    if (gameState.selectedArmy === army) {
                        ctx.strokeStyle = '#00ff00';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.arc(army.x, army.y, army.size + 3, 0, Math.PI * 2);
                        ctx.stroke();
                    }
                    
                    // Army strength indicator
                    ctx.fillStyle = 'white';
                    ctx.font = '8px Arial';
                    ctx.fillText(army.strength, army.x-3, army.y+3);
                });
            });

            // Draw attack target
            if (gameState.attackTarget) {
                ctx.strokeStyle = '#ff0000';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(gameState.attackTarget.x, gameState.attackTarget.y, 8, 0, Math.PI * 2);
                ctx.stroke();
            }
        }

        // Click to select army or set attack target
        canvas.addEventListener('click', (event) => {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor(event.clientX - rect.left);
            const y = Math.floor(event.clientY - rect.top);
            
            // First check if clicking on a player army
            const clickedArmy = gameState.player.armies.find(army => {
                const distance = Math.sqrt((army.x - x) ** 2 + (army.y - y) ** 2);
                return distance <= army.size;
            });
            
            if (clickedArmy) {
                // Select army
                gameState.selectedArmy = clickedArmy;
                gameState.attackTarget = null;
                addGameLog(`Selected army (strength: ${clickedArmy.strength})`);
            } else if (gameState.selectedArmy) {
                // Set attack target for selected army
                gameState.attackTarget = { x, y };
                gameState.selectedArmy.target = { x, y };
                addGameLog(`Attack order to (${x}, ${y})`);
            } else {
                addGameLog('Select an army first!');
            }
            
            render();
            updateUI();
        });

        // Army movement, conquering, and combat
        function updateGame() {
            // Move all armies and handle combat
            [gameState.player, ...gameState.bots].forEach(owner => {
                owner.armies.forEach((army, index) => {
                    if (army.target) {
                        const dx = army.target.x - army.x;
                        const dy = army.target.y - army.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance > 1) {
                            // Move towards target
                            army.x += (dx / distance) * 2;
                            army.y += (dy / distance) * 2;
                            
                            // Claim territory in radius based on army size
                            claimTerritory(Math.floor(army.x), Math.floor(army.y), owner.id, Math.floor(army.size / 2));
                            
                            // Check for combat with enemy armies
                            checkCombat(army, owner);
                        } else {
                            // Reached target
                            army.target = null;
                            if (gameState.selectedArmy === army) {
                                gameState.attackTarget = null;
                            }
                        }
                    }
                });
            });
            
            // Simple bot AI
            gameState.bots.forEach(bot => {
                bot.armies.forEach(army => {
                    if (!army.target || Math.random() < 0.01) {
                        army.target = {
                            x: Math.random() * MAP_SIZE,
                            y: Math.random() * MAP_SIZE
                        };
                    }
                });
            });
            
            // Generate resources
            gameState.player.gold += gameState.player.territories.size * 0.1;
            gameState.player.manpower += 0.5;
            
            render();
            updateUI();
        }

        function checkCombat(army, owner) {
            // Check against all enemies
            const enemies = owner.id === 'player' ? gameState.bots : 
                          [gameState.player, ...gameState.bots.filter(b => b.id !== owner.id)];
            
            enemies.forEach(enemy => {
                enemy.armies.forEach((enemyArmy, enemyIndex) => {
                    const distance = Math.sqrt((army.x - enemyArmy.x) ** 2 + (army.y - enemyArmy.y) ** 2);
                    const combatRange = army.size + enemyArmy.size;
                    
                    if (distance < combatRange) {
                        // Combat!
                        if (army.strength > enemyArmy.strength) {
                            // Attacker wins
                            army.strength -= enemyArmy.strength * 0.3;
                            enemy.armies.splice(enemyIndex, 1);
                            addGameLog(`COMBAT: ${owner.id} defeated ${enemy.id}!`);
                        } else {
                            // Defender wins
                            enemyArmy.strength -= army.strength * 0.3;
                            owner.armies.splice(owner.armies.indexOf(army), 1);
                            if (gameState.selectedArmy === army) {
                                gameState.selectedArmy = null;
                            }
                            addGameLog(`COMBAT: ${enemy.id} defeated ${owner.id}!`);
                        }
                    }
                });
            });
        }

        function trainArmy() {
            if (gameState.player.gold >= 50 && gameState.player.manpower >= 20) {
                gameState.player.gold -= 50;
                gameState.player.manpower -= 20;
                
                // Find a owned territory to spawn army
                const territories = Array.from(gameState.player.territories);
                if (territories.length > 0) {
                    const [x, y] = territories[0].split('-').map(Number);
                    createArmy(x, y, 'player', 10);
                    addGameLog('Trained new army!');
                }
                
                updateUI();
            } else {
                addGameLog('Not enough resources!');
            }
        }

        function upgradeArmy() {
            if (gameState.selectedArmy && gameState.player.gold >= 30) {
                gameState.player.gold -= 30;
                gameState.selectedArmy.strength += 5;
                gameState.selectedArmy.size += 1;
                addGameLog('Army upgraded! +5 strength');
                updateUI();
            }
        }

        function mergeArmies() {
            if (gameState.player.armies.length >= 2 && gameState.player.gold >= 20) {
                gameState.player.gold -= 20;
                const mainArmy = gameState.selectedArmy || gameState.player.armies[0];
                const otherArmy = gameState.player.armies.find(a => a !== mainArmy);
                
                if (otherArmy) {
                    mainArmy.strength += otherArmy.strength;
                    mainArmy.size = Math.max(3, mainArmy.strength / 3);
                    gameState.player.armies.splice(gameState.player.armies.indexOf(otherArmy), 1);
                    addGameLog('Armies merged!');
                    updateUI();
                }
            }
        }

        function updateUI() {
            document.getElementById('gold').textContent = Math.floor(gameState.player.gold);
            document.getElementById('manpower').textContent = Math.floor(gameState.player.manpower);
            document.getElementById('territories').textContent = gameState.player.territories.size;
            
            // Update army info
            if (gameState.selectedArmy) {
                document.getElementById('armyInfo').innerHTML = 
                    `Strength: ${gameState.selectedArmy.strength}<br>Size: ${Math.floor(gameState.selectedArmy.size)}`;
            } else {
                document.getElementById('armyInfo').textContent = 'None selected';
            }
        }

        function addGameLog(message) {
            const log = document.getElementById('gameLog');
            const entry = document.createElement('div');
            entry.textContent = `> ${message}`;
            entry.style.margin = '2px 0';
            log.prepend(entry);
            
            while (log.children.length > 8) {
                log.removeChild(log.lastChild);
            }
        }

        // Start game
        initGame();
        setInterval(updateGame, 50);
    </script>
</body>
</html>
