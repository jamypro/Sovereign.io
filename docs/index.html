<!DOCTYPE html>
<html>
<head>
    <title>Sovereign.io - Pixel Conquest</title>
    <style>
        body { 
            margin: 0; 
            padding: 20px; 
            background: #0a0a0a; 
            color: white; 
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .game-area {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            justify-content: center;
        }
        canvas {
            border: 2px solid #3498db;
            background: #111;
            image-rendering: pixelated;
        }
        .ui-panel {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 8px;
            min-width: 200px;
            text-align: left;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }
        button:hover {
            background: #2980b9;
        }
        button:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
        }
        .resource {
            margin: 8px 0;
            padding: 6px;
            background: #2c3e50;
            border-radius: 4px;
            font-size: 14px;
        }
        #attackIndicator {
            position: absolute;
            width: 10px;
            height: 10px;
            background: red;
            border-radius: 50%;
            pointer-events: none;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè∞ Sovereign.io - Pixel Conquest</h1>
        <p>Click anywhere to set attack target, then watch your army conquer!</p>
        
        <div class="game-area">
            <div style="position: relative;">
                <canvas id="gameCanvas" width="400" height="400"></canvas>
                <div id="attackIndicator"></div>
            </div>
            
            <div class="ui-panel">
                <h3>Player Resources</h3>
                <div class="resource">üí∞ Gold: <span id="gold">200</span></div>
                <div class="resource">üë• Manpower: <span id="manpower">100</span></div>
                <div class="resource">üè† Territories: <span id="territories">1</span></div>
                
                <h3>Army Actions</h3>
                <button onclick="trainArmy()">
                    Train Army (50 gold)
                </button>
                <button onclick="upgradeArmy()">
                    Upgrade Army (30 gold)
                </button>
                
                <h3>Game Info</h3>
                <div id="gameLog" style="font-size: 12px; max-height: 150px; overflow-y: auto;"></div>
            </div>
        </div>
        
        <div style="margin-top: 20px; font-size: 12px; color: #777;">
            <p><strong>How to play:</strong> Click anywhere on map to set attack target. Your army will move and conquer all pixels along the path!</p>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            player: {
                id: 'player',
                color: '#3498db',
                gold: 200,
                manpower: 100,
                territories: new Set(),
                armies: []
            },
            bots: [
                { id: 'bot1', color: '#e74c3c', territories: new Set(), armies: [] },
                { id: 'bot2', color: '#f39c12', territories: new Set(), armies: [] }
            ],
            map: [],
            attackTarget: null
        };

        // Canvas setup
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const PIXEL_SIZE = 1; // 1x1 pixel territories!
        const MAP_SIZE = 400; // 400x400 grid

        // Initialize game
        function initGame() {
            createMap();
            
            // Give player starting territory in center
            claimTerritory(200, 200, 'player');
            gameState.player.territories.add('200-200');
            
            // Give bots starting territories
            claimTerritory(50, 50, 'bot1');
            gameState.bots[0].territories.add('50-50');
            claimTerritory(350, 350, 'bot2');  
            gameState.bots[1].territories.add('350-350');
            
            // Create starting armies
            createArmy(200, 200, 'player');
            createArmy(50, 50, 'bot1');
            createArmy(350, 350, 'bot2');
            
            render();
            updateUI();
            addGameLog('Game started! Click anywhere to attack.');
        }

        function createMap() {
            for (let x = 0; x < MAP_SIZE; x++) {
                for (let y = 0; y < MAP_SIZE; y++) {
                    gameState.map.push({
                        x, y,
                        owner: null
                    });
                }
            }
        }

        function createArmy(x, y, owner) {
            const ownerObj = owner === 'player' ? gameState.player : gameState.bots.find(b => b.id === owner);
            ownerObj.armies.push({
                x, y,
                target: null,
                strength: 10,
                size: 3 // Circle radius
            });
        }

        function claimTerritory(x, y, owner) {
            const territory = gameState.map.find(t => t.x === x && t.y === y);
            if (territory && territory.owner !== owner) {
                // Remove from previous owner
                if (territory.owner === 'player') {
                    gameState.player.territories.delete(`${x}-${y}`);
                } else if (territory.owner) {
                    const prevBot = gameState.bots.find(b => b.id === territory.owner);
                    if (prevBot) prevBot.territories.delete(`${x}-${y}`);
                }
                
                // Add to new owner
                territory.owner = owner;
                if (owner === 'player') {
                    gameState.player.territories.add(`${x}-${y}`);
                } else {
                    const bot = gameState.bots.find(b => b.id === owner);
                    if (bot) bot.territories.add(`${x}-${y}`);
                }
            }
        }

        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw territories - only changed pixels for performance
            gameState.map.forEach(territory => {
                if (territory.owner === 'player') {
                    ctx.fillStyle = gameState.player.color;
                } else if (territory.owner === 'bot1') {
                    ctx.fillStyle = gameState.bots[0].color;
                } else if (territory.owner === 'bot2') {
                    ctx.fillStyle = gameState.bots[1].color;
                } else {
                    return; // Don't draw neutral territories for performance
                }
                
                ctx.fillRect(territory.x, territory.y, PIXEL_SIZE, PIXEL_SIZE);
            });

            // Draw armies as circles
            [gameState.player, ...gameState.bots].forEach(owner => {
                owner.armies.forEach(army => {
                    ctx.fillStyle = owner.color;
                    ctx.beginPath();
                    ctx.arc(army.x, army.y, army.size, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Army strength indicator
                    ctx.fillStyle = 'white';
                    ctx.font = '8px Arial';
                    ctx.fillText(army.strength, army.x-3, army.y+3);
                });
            });

            // Draw attack target
            if (gameState.attackTarget) {
                ctx.strokeStyle = '#ff0000';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(gameState.attackTarget.x, gameState.attackTarget.y, 8, 0, Math.PI * 2);
                ctx.stroke();
            }
        }

        // Click to set attack target
        canvas.addEventListener('click', (event) => {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor(event.clientX - rect.left);
            const y = Math.floor(event.clientY - rect.top);
            
            gameState.attackTarget = { x, y };
            
            // Set target for player's first army
            if (gameState.player.armies.length > 0) {
                gameState.player.armies[0].target = { x, y };
                addGameLog(`Attack target set at (${x}, ${y})`);
            }
            
            render();
        });

        // Army movement and conquering
        function updateGame() {
            // Move player army
            gameState.player.armies.forEach(army => {
                if (army.target) {
                    const dx = army.target.x - army.x;
                    const dy = army.target.y - army.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance > 1) {
                        // Move towards target
                        army.x += (dx / distance) * 2;
                        army.y += (dy / distance) * 2;
                        
                        // Claim territory at current position (conquer path!)
                        claimTerritory(Math.floor(army.x), Math.floor(army.y), 'player');
                    } else {
                        // Reached target
                        army.target = null;
                        gameState.attackTarget = null;
                    }
                }
            });
            
            // Simple bot AI - move towards center
            gameState.bots.forEach(bot => {
                bot.armies.forEach(army => {
                    if (!army.target || Math.random() < 0.02) {
                        army.target = {
                            x: Math.random() * MAP_SIZE,
                            y: Math.random() * MAP_SIZE
                        };
                    }
                    
                    const dx = army.target.x - army.x;
                    const dy = army.target.y - army.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance > 1) {
                        army.x += (dx / distance) * 1;
                        army.y += (dy / distance) * 1;
                        claimTerritory(Math.floor(army.x), Math.floor(army.y), bot.id);
                    }
                });
            });
            
            // Generate resources
            gameState.player.gold += gameState.player.territories.size * 0.1;
            gameState.player.manpower += 0.5;
            
            render();
            updateUI();
        }

        function trainArmy() {
            if (gameState.player.gold >= 50 && gameState.player.manpower >= 20) {
                gameState.player.gold -= 50;
                gameState.player.manpower -= 20;
                
                // Find a owned territory to spawn army
                const territories = Array.from(gameState.player.territories);
                if (territories.length > 0) {
                    const [x, y] = territories[0].split('-').map(Number);
                    createArmy(x, y, 'player');
                    addGameLog('Trained new army!');
                }
                
                updateUI();
            } else {
                addGameLog('Not enough resources!');
            }
        }

        function upgradeArmy() {
            if (gameState.player.gold >= 30 && gameState.player.armies.length > 0) {
                gameState.player.gold -= 30;
                gameState.player.armies[0].strength += 5;
                gameState.player.armies[0].size += 1;
                addGameLog('Army upgraded! +5 strength');
                updateUI();
            }
        }

        function updateUI() {
            document.getElementById('gold').textContent = Math.floor(gameState.player.gold);
            document.getElementById('manpower').textContent = Math.floor(gameState.player.manpower);
            document.getElementById('territories').textContent = gameState.player.territories.size;
        }

        function addGameLog(message) {
            const log = document.getElementById('gameLog');
            const entry = document.createElement('div');
            entry.textContent = `> ${message}`;
            entry.style.margin = '2px 0';
            log.prepend(entry);
            
            while (log.children.length > 8) {
                log.removeChild(log.lastChild);
            }
        }

        // Start game
        initGame();
        setInterval(updateGame, 50); // Fast game loop for smooth movement
    </script>
</body>
</html>
